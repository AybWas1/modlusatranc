<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modlu Satranç - Pro</title>
    <style>
        :root {
            --light: #ebecd0;
            --dark: #779556;
            --select: #ffff33;
            --last: rgba(255, 255, 0, 0.5);
            --dot: rgba(0, 0, 0, 0.15);
        }

        body {
            margin: 0;
            background: #2c2c2c;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        #container {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Karelerin uzamasını engelleyen ana tahta yapısı */
        #board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            width: min(90vw, 480px);
            aspect-ratio: 1 / 1;
            border: 2px solid #111;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .square {
            position: relative;
            /* İçeriğin kareyi genişletmesini engellemek için */
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .light { background: var(--light); }
        .dark { background: var(--dark); }

        /* Taşların Görünümü */
        .piece {
            font-size: clamp(32px, 8vw, 50px);
            z-index: 5;
            user-select: none;
            transition: transform 0.1s ease;
            cursor: grab;
            /* Daha güzel bir görünüm için gölge ve derinlik */
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.4));
            line-height: 1;
        }

        .piece:active { transform: scale(1.2); }

        .selected {
            background-color: var(--select) !important;
        }

        /* Hamle Noktaları */
        .dot {
            width: 25%;
            height: 25%;
            background: var(--dot);
            border-radius: 50%;
            position: absolute;
            z-index: 2;
        }

        #side {
            min-width: 180px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-bottom: 4px solid #111;
        }

        /* Market Yazısı Kalktı, Sadece Butonlar */
        #pool {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        #pool span {
            font-size: 30px;
            background: #333;
            border-radius: 8px;
            padding: 5px;
            cursor: pointer;
            transition: 0.2s;
            border-bottom: 3px solid #000;
        }

        #pool span:hover:not(.disabled) { background: #444; transform: translateY(-2px); }
        #pool span.disabled { opacity: 0.1; cursor: not-allowed; filter: grayscale(1); }
        #pool span.active { 
            background: #779556 !important; 
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        #score { font-weight: bold; font-size: 1.1em; color: #ffcc00; }
        #turn { font-weight: bold; letter-spacing: 1px; }
    </style>
</head>
<body>

    <h2 style="margin-top:0">♟️ Modlu Satranç</h2>

    <div id="container">
        <div id="board"></div>
        <div id="side">
            <div class="panel" id="turn">SIRA: BEYAZ</div>
            <div class="panel" id="score">B: 0 | S: 0</div>
            <div id="pool" class="panel"></div>
        </div>
    </div>

    <script>
        window.onload = () => {
            const boardEl = document.getElementById("board");
            const poolEl = document.getElementById("pool");
            const turnEl = document.getElementById("turn");
            const scoreEl = document.getElementById("score");

            const PIECES = {
                p: { s: "♙", c: 1 }, n: { s: "♘", c: 3 }, b: { s: "♗", c: 3 },
                r: { s: "♖", c: 5 }, q: { s: "♕", c: 9 }, k: { s: "♔", c: 0 }
            };

            let board = [...Array(8)].map(() => Array(8).fill(null));
            board[0][0] = { t: "k", c: "w" }; 
            board[7][7] = { t: "k", c: "b" }; 

            let turn = "w";
            let score = { w: 0, b: 0 };
            let selected = null;
            let moves = [];
            let placing = null;

            function draw() {
                boardEl.innerHTML = "";
                for (let y = 7; y >= 0; y--) {
                    for (let x = 0; x < 8; x++) {
                        const sq = document.createElement("div");
                        sq.className = `square ${(x + y) % 2 ? "dark" : "light"}`;
                        
                        const p = board[x][y];
                        if (p) {
                            const sp = document.createElement("div");
                            sp.className = "piece";
                            if (selected && selected.x === x && selected.y === y) sq.classList.add("selected");
                            sp.textContent = PIECES[p.t].s;
                            sp.style.color = p.c === "w" ? "#fff" : "#000";
                            sq.appendChild(sp);
                        }

                        if (moves.some(m => m.x === x && m.y === y) || (placing && !p)) {
                            const d = document.createElement("div");
                            d.className = "dot";
                            sq.appendChild(d);
                        }

                        sq.onclick = () => click(x, y);
                        boardEl.appendChild(sq);
                    }
                }
                turnEl.textContent = `SIRA: ${turn === "w" ? "BEYAZ" : "SİYAH"}`;
                turnEl.style.color = turn === "w" ? "#fff" : "#999";
                scoreEl.innerHTML = `PUAN<br>B: ${score.w} — S: ${score.b}`;
                drawPool();
            }

            function drawPool() {
                poolEl.innerHTML = "";
                for (const k in PIECES) {
                    if (k === "k") continue;
                    const s = document.createElement("span");
                    s.textContent = PIECES[k].s;
                    s.title = `${PIECES[k].c} Puan`;
                    if (PIECES[k].c > score[turn]) s.className = "disabled";
                    if (placing === k) s.className = "active";
                    s.onclick = (e) => {
                        e.stopPropagation();
                        placing = (placing === k) ? null : k;
                        selected = null;
                        moves = [];
                        draw();
                    };
                    poolEl.appendChild(s);
                }
            }

            function click(x, y) {
                if (placing) {
                    if (!board[x][y] && score[turn] >= PIECES[placing].c) {
                        board[x][y] = { t: placing, c: turn };
                        score[turn] -= PIECES[placing].c;
                        placing = null;
                        turn = turn === "w" ? "b" : "w";
                    }
                } else {
                    const p = board[x][y];
                    if (p && p.c === turn) {
                        if (selected && selected.x === x && selected.y === y) {
                            selected = null; moves = [];
                        } else {
                            selected = { x, y };
                            moves = getSimpleMoves(x, y);
                        }
                    } else if (selected && moves.some(m => m.x === x && m.y === y)) {
                        board[x][y] = board[selected.x][selected.y];
                        board[selected.x][selected.y] = null;
                        score[turn] = Math.min(10, score[turn] + 1);
                        selected = null;
                        moves = [];
                        turn = turn === "w" ? "b" : "w";
                    } else {
                        selected = null; moves = [];
                    }
                }
                draw();
            }

            function getSimpleMoves(x, y) {
                const res = [];
                // Şimdilik tüm taşlar için 1 kare çevre hareketi (Önceki kodundaki mantık)
                for(let dx=-1; dx<=1; dx++) {
                    for(let dy=-1; dy<=1; dy++) {
                        if(dx===0 && dy===0) continue;
                        let nx=x+dx, ny=y+dy;
                        if(nx>=0 && nx<8 && ny>=0 && ny<8) {
                            if(!board[nx][ny] || board[nx][ny].c !== turn) res.push({x:nx, y:ny});
                        }
                    }
                }
                return res;
            }
            draw();
        };
    </script>
</body>
</html>
