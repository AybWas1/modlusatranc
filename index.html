<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Modlu Satranç</title>

<style>
body {
  margin: 0;
  font-family: system-ui;
  background: #111;
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
}

#game {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

#board {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  width: 90vw;
  max-width: 360px;
  aspect-ratio: 1;
  border: 2px solid #555;
}

.cell {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  user-select: none;
}

.cell.white { background: #eee; color: black; }
.cell.black { background: #444; }

.cell.selected { outline: 3px solid gold; }

#side {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

button {
  font-size: 1.3rem;
  padding: 6px;
}

#info {
  margin-top: 10px;
}
</style>
</head>

<body>

<h3>♟️ Modlu Satranç</h3>

<div id="game">
  <div id="board"></div>

  <div id="side">
    <button data-piece="P">♙ (1)</button>
    <button data-piece="N">♘ (3)</button>
    <button data-piece="B">♗ (3)</button>
    <button data-piece="R">♖ (5)</button>
    <button data-piece="Q">♕ (9)</button>
  </div>
</div>

<div id="info"></div>

<script>
const COST = { P:1, N:3, B:3, R:5, Q:9 };
const ICON = {
  wP:"♙", wN:"♘", wB:"♗", wR:"♖", wQ:"♕", wK:"♔",
  bP:"♟", bN:"♞", bB:"♝", bR:"♜", bQ:"♛", bK:"♚"
};

let board = Array.from({length:8},()=>Array(8).fill(null));
board[7][0] = "wK";
board[0][7] = "bK";

let turn = "w";
let points = { w:0, b:0 };
let selected = null;
let addPiece = null;

const boardDiv = document.getElementById("board");
const info = document.getElementById("info");

function draw() {
  boardDiv.innerHTML = "";
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const cell = document.createElement("div");
      cell.className = "cell " + ((r+c)%2 ? "black":"white");
      if(selected && selected.r===r && selected.c===c) cell.classList.add("selected");
      if(board[r][c]) cell.textContent = ICON[board[r][c]];
      cell.onclick = ()=>clickCell(r,c);
      boardDiv.appendChild(cell);
    }
  }
  info.textContent = `Sıra: ${turn==="w"?"Beyaz":"Siyah"} | Puan: ${points[turn]}/10`;
}

function clickCell(r,c){
  const piece = board[r][c];

  // Hareket
  if(selected && !addPiece){
    if(isLegal(selected.r,selected.c,r,c)){
      board[r][c] = board[selected.r][selected.c];
      board[selected.r][selected.c] = null;
      selected = null;
      points[turn] = Math.min(10, points[turn]+1);
      if(checkMate(opponent(turn))){
        alert((turn==="w"?"Beyaz":"Siyah")+" kazandı!");
      }
      turn = opponent(turn);
    } else selected = null;
  }

  // Seç
  else if(piece && piece[0]===turn){
    selected = {r,c};
  }

  // Taş ekle
  else if(addPiece && !piece){
    if(points[turn] >= COST[addPiece]){
      board[r][c] = turn + addPiece;
      points[turn] -= COST[addPiece];
      addPiece = null;
      turn = opponent(turn);
    }
  }

  draw();
}

function opponent(t){ return t==="w"?"b":"w"; }

// GERÇEK SATRANÇ HAREKETLERİ (temel)
function isLegal(sr,sc,tr,tc){
  const p = board[sr][sc];
  if(!p) return false;
  const type = p[1];
  const dr = tr-sr, dc = tc-sc;

  if(type==="K") return Math.max(Math.abs(dr),Math.abs(dc))===1;
  if(type==="R") return (dr===0||dc===0) && clear(sr,sc,tr,tc);
  if(type==="B") return Math.abs(dr)===Math.abs(dc) && clear(sr,sc,tr,tc);
  if(type==="Q") return ((dr===0||dc===0)||Math.abs(dr)===Math.abs(dc)) && clear(sr,sc,tr,tc);
  if(type==="N") return (Math.abs(dr)*Math.abs(dc)===2);
  if(type==="P"){
    const dir = p[0]==="w"?-1:1;
    return dr===dir && dc===0 && !board[tr][tc];
  }
  return false;
}

function clear(sr,sc,tr,tc){
  const dr=Math.sign(tr-sr), dc=Math.sign(tc-sc);
  let r=sr+dr, c=sc+dc;
  while(r!==tr||c!==tc){
    if(board[r][c]) return false;
    r+=dr; c+=dc;
  }
  return true;
}

// ŞAH MAT (basit)
function checkMate(t){
  for(let r=0;r<8;r++)
    for(let c=0;c<8;c++)
      if(board[r][c]===t+"K") return false;
  return true;
}

// Panel
document.querySelectorAll("button").forEach(b=>{
  b.onclick=()=>{
    addPiece = b.dataset.piece;
    selected = null;
  };
});

draw();
</script>

</body>
</html>
